var SOCIAL_API_INITIALIZED_MSG="social_api_initialized",SOCIAL_API_INITIALIZATION_FAILED_MSG="social_api_initialization_failed",USER_PROFILE_LOADED_MSG="social_user_profile_loaded",USER_PROFILE_LOADING_FAILED_MSG="social_user_profile_loading_failed",USER_AUTHORIZED_MSG="social_user_authorized",USER_AUTHORIZATION_FAILED_MSG="social_authorization_failed",ADS_INITIALIZED_MSG="ads_initialized",PRODUCT_PURCHASED_MSG="social_product_purchased",PRODUCT_PURCHASE_FAILED_MSG="social_product_purchase_failed",REWARDED_AD_LOADED_MSG="rewarded_ad_loaded",REWARDED_AD_SHOWED_MSG="rewarded_ad_showed",REWARDED_AD_SHOW_FAILED_MSG="rewarded_ad_show_failed",INTERSTITIAL_AD_LOADED_MSG="interstitial_ad_loaded",INTERSTITIAL_AD_SHOWED_MSG="interstitial_ad_showed",INTERSTITIAL_AD_SHOW_FAILED_MSG="interstitial_ad_show_failed",BANNER_AD_LOADED_MSG="banner_ad_loaded",BANNER_AD_SHOWED_MSG="banner_ad_showed",BANNER_AD_SHOW_FAILED_MSG="banner_ad_show_failed",NEW_AUTH_DATA_RECIEVED="new_auth_data_recieved",AUTH_DATA_EXPIRED="auth_data_expired",DEVICE_DESKTOP="desktop",DEVICE_MOBILE_WEB="mobile_web",DEVICE_UNKNOWN="unknown";function parseJwt(token){token=token.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),token=decodeURIComponent(window.atob(token).split("").map(function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(token)}var socialPlatform={_cg:void 0,_player:void 0,_hasAdBlock:void 0,_bannerShown:!1,_bannerTime:0,_getNewToken:function(attempt){console.log("Start getting token"),attempt=(attempt||0)+1,socialPlatform._cg.SDK.user.getUserToken().then(token=>{console.log("NEW token got");var data=parseJwt(token);socialPlatform._player=data,JsToDef.send(NEW_AUTH_DATA_RECIEVED,{session_key:token}),socialPlatform._restartTokenReceiving()}).catch(error=>{console.log("NEW token got error",error),attempt<5?socialPlatform._tokenGettingHandle=setTimeout(()=>{socialPlatform._getNewToken(attempt)},2*attempt*1e3):JsToDef.send(AUTH_DATA_EXPIRED,{error:"Unable to get new token "+error.code})})},_restartTokenReceiving:function(){socialPlatform._restartTokenHandle&&(clearTimeout(socialPlatform._restartTokenHandle),delete socialPlatform._restartTokenHandle),socialPlatform._tokenGettingHandle&&(clearTimeout(socialPlatform._tokenGettingHandle),delete socialPlatform._tokenGettingHandle),socialPlatform._restartTokenHandle=setTimeout(socialPlatform._getNewToken,18e5)},_auth_listener:function(user){console.log("User changed",user),socialPlatform._cg.SDK.user.getUserToken().then(token=>{var data=parseJwt(token);socialPlatform._player=data,JsToDef.send(USER_AUTHORIZED_MSG,{social_side:!0,auth_fields:{api_type:32,api_uid:data.userId,session_key:token}}),socialPlatform._restartTokenReceiving()}).catch(error=>{JsToDef.send(USER_AUTHORIZATION_FAILED_MSG,{social_side:!0,error:"Unable to authorize "+error.code})})},progress:function(progress){console.log("Loading progress:",progress)},preInitialize:function(callback){if(void 0===window.CrazyGames)throw new Error("Unable to resolve CrazyGames");window.CrazyGames.SDK.init().then(()=>{socialPlatform._cg=window.CrazyGames,socialPlatform._cg.SDK.game.loadingStart(),callback(),socialPlatform._cg.SDK.ad.hasAdblock().then(result=>{socialPlatform._hasAdBlock=result}).catch(error=>{socialPlatform._hasAdBlock=!1,console.log(error)}),socialPlatform._cg.SDK.user.addAuthListener(socialPlatform._auth_listener),XPayStationWidget.on(XPayStationWidget.eventTypes.CLOSE,function(event,data){console.log(event,data),socialPlatform._succesfull_purchase||JsToDef.send(PRODUCT_PURCHASE_FAILED_MSG,{error:"Purchase failed"}),socialPlatform._succesfull_purchase=void 0})}).catch(error=>{callback(),console.log(error)})},initialize:function(){socialPlatform._cg.SDK.user.isUserAccountAvailable?socialPlatform._cg.SDK.user.getUser().then(playerInfo=>{playerInfo?socialPlatform._cg.SDK.user.getUserToken().then(token=>{var data=parseJwt(token);socialPlatform._player=data,JsToDef.send(SOCIAL_API_INITIALIZED_MSG,{auth_fields:{api_type:32,api_uid:data.userId,session_key:token}}),socialPlatform._restartTokenReceiving()}).catch(error=>{JsToDef.send(SOCIAL_API_INITIALIZATION_FAILED_MSG,{error:"Unable to get user token "+error.code})}):JsToDef.send(SOCIAL_API_INITIALIZED_MSG,{auth_fields:{api_type:932}})}).catch(error=>{JsToDef.send(SOCIAL_API_INITIALIZATION_FAILED_MSG,{error:"Unable to authorize "+error.code})}):JsToDef.send(SOCIAL_API_INITIALIZED_MSG,{auth_fields:{api_type:932}})},handleAPICallback:function(event){if(event&&event.data)try{var eventData=JSON.parse(event.data);"order-status"==eventData.command&&eventData.data&&eventData.data.order_id&&eventData.data.items&&(JsToDef.send(PRODUCT_PURCHASED_MSG,{product_id:eventData.data.items[0].sku,transaction_id:eventData.data.order_id}),socialPlatform._succesfull_purchase=!0)}catch(error){console.log(error)}},canLogin:function(){return!0},login:function(){socialPlatform._cg.SDK.user.showAuthPrompt().then(()=>{socialPlatform._cg.SDK.user.getUserToken().then(token=>{var data=parseJwt(token);socialPlatform._player=data,JsToDef.send(USER_AUTHORIZED_MSG,{auth_fields:{api_type:32,api_uid:data.userId,session_key:token}})}).catch(error=>{JsToDef.send(USER_AUTHORIZATION_FAILED_MSG,{error:"Unable to authorize "+error.code})})}).catch(error=>{JsToDef.send(USER_AUTHORIZATION_FAILED_MSG,{error:"Unable to authorize "+error.code})})},getDefaultLocale:function(){},getCountryCode:function(){},getInstallReferrer:function(){},loadUserProfile:function(){socialPlatform._player?JsToDef.send(USER_PROFILE_LOADED_MSG,{profile:{first_name:socialPlatform._player.username||""}}):JsToDef.send(USER_PROFILE_LOADING_FAILED_MSG,{error:"Not authorized user"})},canCreateShortcut:function(){return!1},createShortcut:function(){throw new Error("Not implemented")},getStoreName:function(){return"web"},loadProducts:function(){throw new Error("Not implemented")},buyProduct:function(params){params.childWindow={target:"_self"},XPayStationWidget.init(params),XPayStationWidget.open()},finishTransaction:function(){throw new Error("Not implemented")},initializeAds:function(){JsToDef.send(ADS_INITIALIZED_MSG),socialPlatform.preloadInterstitial(),socialPlatform.preloadRewarded(),socialPlatform.canShowBanner()&&socialPlatform.preloadBanner()},preloadInterstitial:function(){JsToDef.send(INTERSTITIAL_AD_LOADED_MSG)},showInterstitial:function(){socialPlatform._cg.SDK.ad.requestAd("midgame",{adFinished:()=>JsToDef.send(INTERSTITIAL_AD_SHOWED_MSG),adError:error=>{console.log(error),JsToDef.send(INTERSTITIAL_AD_SHOW_FAILED_MSG)},adStarted:()=>{console.log("Start interstitial ad"),socialPlatform.hideBanner()}})},preloadRewarded:function(){JsToDef.send(REWARDED_AD_LOADED_MSG)},showRewarded:function(){socialPlatform._cg.SDK.ad.requestAd("rewarded",{adFinished:()=>JsToDef.send(REWARDED_AD_SHOWED_MSG),adError:error=>{console.log(error),JsToDef.send(REWARDED_AD_SHOW_FAILED_MSG)},adStarted:()=>{console.log("Start rewarded ad"),socialPlatform.hideBanner()}})},supportsPageReload:function(){return!0},logEvent:function(){},canShowBanner:function(){return!!window.BANNER_CONTAINER_ID},preloadBanner:function(){JsToDef.send(BANNER_AD_LOADED_MSG)},isBannerShown:function(){return socialPlatform._bannerShown},getBannerTimeout:function(){return 60},onCanvasResize:function(){},showBanner:function(){var currentTime;socialPlatform._bannerShown?JsToDef.send(BANNER_AD_SHOWED_MSG):(currentTime=(new Date).getTime()/1e3)-socialPlatform._bannerTime<socialPlatform.getBannerTimeout()||(socialPlatform._bannerTime=currentTime,socialPlatform.setBannerContainerVisible&&socialPlatform.setBannerContainerVisible(!0),socialPlatform._cg.SDK.banner.requestResponsiveBanner(window.BANNER_CONTAINER_ID).then(()=>{socialPlatform._bannerShown=!0,socialPlatform._bannerOffsetted=!0,socialPlatform.onCanvasResize(),JsToDef.send(BANNER_AD_SHOWED_MSG)}).catch(e=>{socialPlatform.setBannerContainerVisible&&socialPlatform.setBannerContainerVisible(!1),console.log("Error on request responsive banner",e),socialPlatform._bannerShown=!1,socialPlatform._bannerOffsetted=!1,socialPlatform.onCanvasResize(),JsToDef.send(BANNER_AD_SHOW_FAILED_MSG)}))},hideBanner:function(){socialPlatform.setBannerContainerVisible&&socialPlatform.setBannerContainerVisible(!1),socialPlatform._cg.SDK.banner.clearBanner(window.BANNER_CONTAINER_ID),socialPlatform._bannerShown=!1,socialPlatform._bannerOffsetted=!1,socialPlatform.onCanvasResize()},getAdInstallData:function(){},canShare:function(){return!1},share:function(){throw new Error("Not implemented")},markGameReady:function(){socialPlatform._cg.SDK.game.loadingStop()},markGameplayStarted:function(){socialPlatform._cg.SDK.game.gameplayStart()},markGameplayStopped:function(){socialPlatform._cg.SDK.game.gameplayStop()},onUnpause:function(){},onPause:function(){},hasAdblocker:function(){return socialPlatform._hasAdBlock},getPlatformType:function(){var platform=socialPlatform._cg.SDK.user.systemInfo.device.type;return"desktop"===platform?DEVICE_DESKTOP:"mobile"===platform||"tablet"===platform?DEVICE_MOBILE_WEB:DEVICE_UNKNOWN}};window.addEventListener("message",socialPlatform.handleAPICallback);